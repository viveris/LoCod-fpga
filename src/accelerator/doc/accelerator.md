# accelerator : Accelerator block

## Description

<img src="accelerator.drawio.svg" width="360" align="right"/>

The purpose of this IP is to perform the calculations of a function described in the C code passed to the Locod. The design of this IP is generic to adapt to all possible user functions.

There are two input addresses, **param** and **result**, corresponding respectively to where the accelerator will take the input data and where it will put the output data.

At the output of the accelerator block we find an AXI Master interface through which the accelerator can communicate with the RAM.

<br>

## Sub-modules

This module includes :

- the IP generated by Panda from the corresponding C function. These IPs are saved when the Locod script is launched in the [generated_files/](../../generated_files/) folder.

- the [start_stop_ctrl](../../start_stop_ctrl/rtl/start_stop_ctrl.vhd) module which allows to control the state of the Bambu generated IP

- the [master_memory_ctrl](../../master_memory_ctrl/rtl/master_memory_ctrl.v) module which converts the generic memory interface of the generated IP into an AXI Master interface, to be subsequently connected to the SoC

Here is a schematic of the internal connections :

<img src="accelerator_schematic.drawio.svg" width="1000"/>

<br>

## Requierments

The Locod package ([locod_package.vhd](../../common/locod_package.vhd)) is needed to compile the Accelerator component (to get the AXI bus types and constants).

<br>

## Template

Please note that this component is only an accelerator template. It cannot be compiled as is, and must be modified to suit your needs.

This step is done automatically when the Locod tool is launched. The script then replaces the various replaceable elements to adapt to the components generated by Bambu.

Here is the list of editable items :

- the entity name **accelerator_X** : must be replaced by the good accelerator index depending on the number used with the macro FPGA()

- the generated IP component **entity work.XXXX** : must be replaced by the component generated by Bambu. The component name corresponds to the function called with the FPGA() macro.

For example, if we called the FPGA macro with a function *foo* to be instancied in the accelerator 1, like this : *FPGA(foo, ..., ..., 1)*. Then accelerator_X must be replaced by accelerator_1 and entity work.XXXX must be replaced by entity.foo.

<br>

## Ports and parameters

| Port name | I/O | Type | Description |
|---|---|---|---|
| clk | I | std_logic | Clock signal |
| rst | I | std_logic | Reset signal, active low |
| start | I | std_logic | Start signal, launch the accelerator |
| reset | I | std_logic | Reset signal, reset the Bambu generated IP |
| param | I | std_logic_vector | Address where the accelerator takes the input data |
| result | I | std_logic_vector | Address where the accelerator puts the output data |
| status_end_process | O | std_logic | End signal, indicates that the accelerator process has finished |
| duration_count_latched | O | std_logic_vector | Latched duration of that the process takes in clock counts |
| M_AXI_out | O | AXI4Lite_m_to_s | Master to slave signals of AXI4 Lite bus |
| M_AXI_in | I | AXI4Lite_s_to_m | Slave to master signals of AXI4 Lite bus |

<br>